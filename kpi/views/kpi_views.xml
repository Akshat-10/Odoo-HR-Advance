<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_kpi_list" model="ir.ui.view">
        <field name="name">kpi.kpi.list</field>
        <field name="model">kpi.kpi</field>
        <field name="arch" type="xml">
            <list decoration-info="state == 'draft'" decoration-success="state == 'completed'">
                <field name="sr_no"/>
                <field name="name"/>
                <field name="employee_id"/>
                <field name="employee_code"/>
                <field name="department_id"/>
                <field name="department_hod"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <record id="view_kpi_form" model="ir.ui.view">
        <field name="name">kpi.kpi.form</field>
        <field name="model">kpi.kpi</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_submit" string="Submit for Approval" type="object" invisible="state != 'draft'" class="btn-info" icon="fa-paper-plane"/>
                    <button name="action_approve_employee" string="Approve (Employee)" type="object" invisible="can_approve_employee != True" class="btn-success" icon="fa-check-circle"/>
                    <button name="action_approve_hod" string="Approve (HOD)" type="object" invisible="can_approve_hod != True" class="btn-success" icon="fa-check-circle"/>
                    <button name="action_complete" string="Complete" type="object" invisible="state != 'hod_approved'" class="btn-success" icon="fa-trophy"/>
                    <button name="action_reject" string="Reject" type="object" invisible="state in ['completed', 'rejected'] or can_approve_employee != True and can_approve_hod != True" class="btn-danger" icon="fa-times"/>
                    <button name="action_undo" string="Undo" type="object" invisible="state == 'draft'" class="btn-warning" icon="fa-undo"/>
                    <field name="state" widget="statusbar" options="{'clickable': '1'}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="name" readonly="1"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="sr_no" readonly="1"/>
                            <field name="employee_id" options="{'no_create': True}"/>
                            <field name="employee_code" readonly="0"/>
                            <field name="department_id" readonly="0"/>
                            <field name="department_hod" readonly="0"/>
                            <field name="designation_id" readonly="0"/>
                        </group>
                        <group>
                            <field name="job_summary"/>
                            <field name="can_approve_employee" invisible="1"/>
                            <field name="can_approve_hod" invisible="1"/>
                            <field name="employee_count" invisible="1"/>
                            <widget name="kpi_employee_list"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="KPI Indexing">
                            <field name="kpi_indexing_ids">
                                <list editable="bottom">
                                    <field name="category_id"/>
                                    <field name="sub_category_id"/>
                                    <field name="description"/>
                                    <field name="weightage"/>
                                    <field name="start_date"/>
                                    <field name="review_date"/>
                                </list>
                                <form>
                                    <group>
                                        <field name="category_id"/>
                                        <field name="sub_category_id" domain="[('category_id', '=', category_id)]"/>
                                        <field name="description"/>
                                        <field name="weightage"/>
                                        <field name="start_date"/>
                                        <field name="review_date"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Training Plan">
                            <field name="training_plan_ids">
                                <list editable="bottom">
                                    <field name="training_id"/>
                                    <field name="reason"/>
                                    <field name="budget"/>
                                    <field name="currency_id"/>
                                </list>
                                <form>
                                    <group>
                                        <field name="training_id"/>
                                        <field name="reason"/>
                                        <field name="budget"/>
                                        <field name="currency_id"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_kpi_kanban" model="ir.ui.view">
        <field name="name">kpi.kpi.kanban</field>
        <field name="model">kpi.kpi</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_small_column">
                <field name="sr_no"/>
                <field name="name"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="state"/>
                <field name="activity_ids"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="o_kanban_record">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('hr.employee', 'image_128', record.employee_id.raw_value)"
                                     class="oe_kanban_avatar"
                                     t-att-alt="record.employee_id.value"/>
                            </div>
                            <div class="o_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="name"/>
                                </strong>
                                <div class="o_kanban_record_subtitle text-muted">
                                    <field name="department_id"/>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <div t-attf-class="badge #{record.state.value == 'draft' and 'badge-secondary' or record.state.value == 'employee_approved' and 'badge-info' or record.state.value == 'hod_approved' and 'badge-primary' or record.state.value == 'completed' and 'badge-success' or 'badge-danger'}">
                                            <field name="state"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_kpi" model="ir.actions.act_window">
        <field name="name">KPIs</field>
        <field name="res_model">kpi.kpi</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new KPI record
            </p>
            <p>
                Manage Key Performance Indicators for employees.
            </p>
        </field>
    </record>

    <menuitem id="menu_kpi_root" name="KPI" sequence="8"/>
    <menuitem id="menu_kpi" name="KPIs" parent="menu_kpi_root" action="action_kpi" sequence="5"/>
</odoo>