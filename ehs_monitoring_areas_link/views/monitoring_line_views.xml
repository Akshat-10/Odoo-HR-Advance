<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_permit_monitoring_line_tree" model="ir.ui.view">
        <field name="name">permit.monitoring.line.tree</field>
        <field name="model">permit.monitoring.line</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="permit_model"/>
                <field name="permit_res_id" invisible="1"/>
                <!-- Direct permit links (conditionally visible) -->
                <field name="work_heights_permit_id" optional="hide" invisible="permit_model != 'work.heights.permit'"/>
                <field name="daily_permit_work_id" optional="hide" invisible="permit_model != 'daily.permit.work'"/>
                <field name="hot_work_permit_id" optional="hide" invisible="permit_model != 'hot.work.permit'"/>
                <field name="energized_work_permit_id" optional="hide" invisible="permit_model != 'energized.work.permit'"/>
                <field name="monitoring_area_id"/>
                <field name="user_id"/>
                <field name="datetime"/>
                <field name="compliance_status"/>
                <field name="state" widget="badge"/>
                <field name="expiry_datetime"/>
            </list>
        </field>
    </record>

    <record id="view_permit_monitoring_line_form" model="ir.ui.view">
        <field name="name">permit.monitoring.line.form</field>
        <field name="model">permit.monitoring.line</field>
        <field name="arch" type="xml">
            <form string="Permit Monitoring Line">
                <header>
                    <button name="action_set_draft" string="Set Draft" type="object" class="ehs-btn-draft" groups="ehs_monitoring_areas_link.group_ehs_monitoring_admin" invisible="not (state in ['done','cancel'])" confirm="Reset this to Draft?"/>
                    <button name="action_mark_done" string="Mark Done" type="object" class="oe_highlight ehs-btn-done" invisible="state != 'open'" confirm="Mark this monitoring line as Done?"/>
                    <button name="action_cancel" string="Cancel" type="object" class="ehs-btn-cancel" invisible="not (state in ['open','expired'])" confirm="Cancel this monitoring line?"/>
                    <field name="state" widget="statusbar" statusbar_visible="open,done,expired"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="monitoring_area_id" options="{'no_create': True}" readonly="1"/>
                            <field name="permit_model" readonly="1"/>
                            <field name="permit_res_id" invisible="1" readonly="1"/>
                            <!-- Direct permit links (read-only, visible according to type) -->
                            <field name="work_heights_permit_id" readonly="1" options="{'no_create': True}" invisible="permit_model != 'work.heights.permit'"/>
                            <field name="daily_permit_work_id" readonly="1" options="{'no_create': True}" invisible="permit_model != 'daily.permit.work'"/>
                            <field name="hot_work_permit_id" readonly="1" options="{'no_create': True}" invisible="permit_model != 'hot.work.permit'"/>
                            <field name="energized_work_permit_id" readonly="1" options="{'no_create': True}" invisible="permit_model != 'energized.work.permit'"/>
                            <field name="user_id" readonly="1"/>
                            <field name="datetime" readonly="1"/>
                            <field name="expiry_datetime" readonly="1"/>
                            <field name="time_limit_minutes" readonly="1"/>
                        </group>
                        <group>
                            <field name="compliance_status"/>
                            <field name="call_meeting" invisible="compliance_status != 'not_standard'"/>
                            <field name="action_taken" invisible="compliance_status != 'not_standard'" required="compliance_status == 'not_standard'"/>
                            <field name="meeting_mail_sent" invisible="1"/>
                            <field name="expiry_warn_mail_sent" invisible="1"/>
                            <field name="expired_mail_sent" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Input / What Checked">
                            <field name="input_checked"/>
                        </page>
                        <page string="Attachments">
                            <field name="attachment_ids" widget="many2many_binary"/>
                        </page>
                        <page string="Remarks">
                            <field name="remarks"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_permit_monitoring_line" model="ir.actions.act_window">
        <field name="name">Permit Monitoring Lines</field>
        <field name="res_model">permit.monitoring.line</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Menu item under Monitoring Areas root -->
    <menuitem id="menu_permit_monitoring_lines"
              name="Permit Monitoring Lines"
              parent="monitoring_areas.menu_work_permit_root"
              action="action_permit_monitoring_line"
              sequence="30"/>

</odoo>
